<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OMEXOM RE â€” Dashboard Parc IT</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'DM Sans','Segoe UI',system-ui,sans-serif;background:linear-gradient(135deg,#f8fafc 0%,#eef2ff 50%,#f0f9ff 100%);min-height:100vh;color:#0f172a}
.header{background:linear-gradient(135deg,#0f172a,#1e3a5f);padding:28px 32px 20px;color:#fff;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}
.header-title small{font-size:11px;font-weight:600;color:#94a3b8;letter-spacing:0.1em;text-transform:uppercase;display:block;margin-bottom:4px}
.header-title h1{font-size:26px;font-weight:800;letter-spacing:-0.02em}
.filters{display:flex;gap:8px;flex-wrap:wrap}
.filters select{background:rgba(255,255,255,0.1);color:#fff;border:1px solid rgba(255,255,255,0.2);border-radius:10px;padding:8px 14px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit}
.filters select option{color:#0f172a}
.content{padding:24px 32px;max-width:1440px;margin:0 auto}
.kpi-row{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:24px}
.kpi{background:#fff;border-radius:16px;padding:20px 24px;display:flex;gap:16px;align-items:center;flex:1;min-width:180;box-shadow:0 1px 3px rgba(0,0,0,0.06),0 4px 12px rgba(0,0,0,0.04);border:1px solid #f1f5f9}
.kpi-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.kpi-label{font-size:11px;color:#94a3b8;font-weight:600;text-transform:uppercase;letter-spacing:0.05em}
.kpi-value{font-size:28px;font-weight:800;line-height:1.1;margin-top:2px}
.kpi-sub{font-size:12px;color:#64748b;margin-top:2px}
.grid{display:grid;gap:20px;margin-bottom:20px}
.grid-2{grid-template-columns:1fr 2fr}
.grid-3{grid-template-columns:1fr 1fr 1fr}
.card{background:#fff;border-radius:16px;padding:24px;box-shadow:0 1px 3px rgba(0,0,0,0.06),0 4px 12px rgba(0,0,0,0.04);border:1px solid #f1f5f9}
.card h3{margin:0 0 16px;font-size:15px;font-weight:700;color:#1e293b}
.card canvas{max-height:240px}
.alerts{display:flex;gap:16px;flex-wrap:wrap;margin-top:8px}
.alert-box{border-radius:12px;padding:20px;flex:1;min-width:200}
.alert-box .icon{font-size:28px;margin-bottom:8px}
.alert-box .title{font-weight:700;font-size:14px}
.alert-box .value{font-size:32px;font-weight:800;margin:8px 0}
.alert-box .sub{font-size:12px}
.ent-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
.ent-card{flex:1;min-width:140;border-radius:12px;padding:16px 20px;cursor:pointer;transition:transform 0.15s}
.ent-card:hover{transform:translateY(-2px)}
.ent-card .val{font-weight:800;font-size:24px;color:#1e293b}
.ent-card .name{font-size:12px;font-weight:600;color:#64748b;margin-top:4px}
.footer{text-align:center;padding:24px 0 16px;font-size:12px;color:#94a3b8}
@media(max-width:900px){.grid-2,.grid-3{grid-template-columns:1fr}.kpi-row{flex-direction:column}}
</style>
</head>
<body>

<div class="header">
  <div class="header-title">
    <small>OMEXOM RE Â· Suivi Parc IT</small>
    <h1>ğŸ“Š Dashboard Inventaire</h1>
  </div>
  <div class="filters">
    <select id="filterType"><option value="all">Tous les types</option></select>
    <select id="filterEnt"><option value="all">Toutes les entitÃ©s</option></select>
  </div>
</div>

<div class="content">
  <div class="kpi-row" id="kpis"></div>
  
  <div class="grid grid-2">
    <div class="card"><h3>RÃ©partition par Ã©tat</h3><canvas id="chartEtat"></canvas></div>
    <div class="card"><h3>Stock par type de matÃ©riel</h3><canvas id="chartType"></canvas></div>
  </div>
  
  <div class="grid grid-3">
    <div class="card"><h3>Par marque</h3><canvas id="chartMarque"></canvas></div>
    <div class="card"><h3>VÃ©tustÃ© du parc actif</h3><canvas id="chartAge"></canvas></div>
    <div class="card"><h3>Top modÃ¨les</h3><canvas id="chartModeles"></canvas></div>
  </div>
  
  <div class="card">
    <h3>âš¡ Alertes & Actions recommandÃ©es</h3>
    <div class="alerts" id="alerts"></div>
  </div>
  
  <div class="card" style="margin-top:20px">
    <h3>RÃ©partition par entitÃ©</h3>
    <div class="ent-row" id="entCards"></div>
  </div>
</div>

<div class="footer">DonnÃ©es TeePee Â· Parc IT OMEXOM RE Â· FÃ©vrier 2026</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DONNÃ‰ES (remplacer par API TeePee)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const INV = [];
const types=["Smartphone","Ordinateur portable","Tablette","Casque","Ordinateur fixe"];
const etats=["Actif","SPARE","HS","Rebus"];
const enterprises=["11093-ORES","14504B-ORE O&M","14504A-ORESU","12264-OSI UF"];

// Smartphones
for(let i=0;i<141;i++) INV.push({type:"Smartphone",etat:i<105?"Actif":i<120?"SPARE":i<130?"HS":"Rebus",
  modele:["iPhone 12","iPhone SE (2nd gen)","Galaxy A54 5G","Galaxy A23 5G","iPhone 11","Galaxy A36 5G","iPhone 13 Mini","Galaxy A52s 5G"][i%8],
  marque:[0,1,4,6].includes(i%8)?"Apple":"Samsung",entreprise:enterprises[i%3],dateAchat:new Date(2019+Math.floor(i/35),(i*3)%12,1)});
// Laptops
for(let i=0;i<155;i++) INV.push({type:"Ordinateur portable",etat:i<120?"Actif":i<135?"SPARE":i<145?"HS":"Rebus",
  modele:["EliteBook 660 G11","EliteBook 850 G8","EliteBook 650 G10","ZBook Studio G9","EliteBook 6 G1i","ZBook Studio G10","EliteBook 840 G5","ZBook Fury 16 G10"][i%8],
  marque:"HP",entreprise:enterprises[i%4],dateAchat:new Date(2017+Math.floor(i/30),(i*2)%12,1)});
// Tablettes
for(let i=0;i<37;i++) INV.push({type:"Tablette",etat:i<28?"Actif":i<32?"SPARE":"HS",
  modele:["Galaxy Tab Active 4 Pro","Galaxy Tab Active Pro"][i%2],marque:"Samsung",entreprise:enterprises[i%2],dateAchat:new Date(2020+Math.floor(i/10),(i*4)%12,1)});
// Casques
for(let i=0;i<19;i++) INV.push({type:"Casque",etat:i<16?"Actif":"SPARE",modele:"Casque anti-bruit",marque:"-",entreprise:"11093-ORES",dateAchat:new Date(2023,(i*2)%12,1)});
// Fixes
INV.push({type:"Ordinateur fixe",etat:"Actif",modele:"ThinkStation P300",marque:"HP",entreprise:"14504B-ORE O&M",dateAchat:new Date(2022,3,1)});
INV.push({type:"Ordinateur fixe",etat:"Actif",modele:"Z230",marque:"HP",entreprise:"11093-ORES",dateAchat:new Date(2018,1,1)});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ECOL={Actif:"#22c55e",SPARE:"#3b82f6",HS:"#f59e0b",Rebus:"#ef4444"};
const BCOL={HP:"#0096D6",Apple:"#555555",Samsung:"#1428A0"};
const ICONS={Smartphone:"ğŸ“±","Ordinateur portable":"ğŸ’»",Tablette:"ğŸ“Ÿ",Casque:"ğŸ§","Ordinateur fixe":"ğŸ–¥ï¸"};
function age(d){return Math.floor((new Date(2026,1,27)-d)/(365.25*864e5))}
function count(arr,fn){return arr.filter(fn).length}
function groupBy(arr,key){return arr.reduce((a,x)=>{const k=typeof key==='function'?key(x):x[key];a[k]=(a[k]||0)+1;return a},{});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTERS & RENDER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const selType=document.getElementById('filterType');
const selEnt=document.getElementById('filterEnt');
[...new Set(INV.map(x=>x.type))].sort().forEach(t=>{const o=document.createElement('option');o.value=t;o.textContent=ICONS[t]+' '+t;selType.appendChild(o)});
[...new Set(INV.map(x=>x.entreprise))].sort().forEach(e=>{const o=document.createElement('option');o.value=e;o.textContent=e;selEnt.appendChild(o)});

let charts={};
function render(){
  let data=INV;
  if(selType.value!=='all') data=data.filter(x=>x.type===selType.value);
  if(selEnt.value!=='all') data=data.filter(x=>x.entreprise===selEnt.value);

  const total=data.length;
  const actifs=count(data,x=>x.etat==='Actif');
  const spare=count(data,x=>x.etat==='SPARE');
  const hs=count(data,x=>x.etat==='HS'||x.etat==='Rebus');
  const obs=count(data,x=>x.etat==='Actif'&&age(x.dateAchat)>=5);
  const actifData=data.filter(x=>x.etat==='Actif');
  const avgA=actifData.length?(actifData.reduce((s,x)=>s+age(x.dateAchat),0)/actifData.length).toFixed(1):0;

  // KPIs
  document.getElementById('kpis').innerHTML=[
    {i:"ğŸ“¦",l:"Total matÃ©riels",v:total,s:new Set(data.map(x=>x.type)).size+" catÃ©gories",c:"#6366f1"},
    {i:"âœ…",l:"Actifs",v:actifs,s:Math.round(actifs/total*100)+"% du parc",c:"#22c55e"},
    {i:"ğŸ”„",l:"SPARE disponibles",v:spare,s:"PrÃªts Ã  dÃ©ployer",c:"#3b82f6"},
    {i:"âš ï¸",l:"HS / Rebus",v:hs,s:"Ã€ traiter",c:"#ef4444"},
    {i:"ğŸ“…",l:"Ã‚ge moyen",v:avgA+" ans",s:obs+" machines > 5 ans",c:"#f59e0b"},
  ].map(k=>`<div class="kpi"><div class="kpi-icon" style="background:${k.c}15">${k.i}</div><div><div class="kpi-label">${k.l}</div><div class="kpi-value">${k.v}</div><div class="kpi-sub">${k.s}</div></div></div>`).join('');

  // Destroy old charts
  Object.values(charts).forEach(c=>c.destroy());
  charts={};

  // Chart Ã‰tat (donut)
  const etatG=groupBy(data,'etat');
  charts.etat=new Chart(document.getElementById('chartEtat'),{type:'doughnut',data:{
    labels:Object.keys(etatG),datasets:[{data:Object.values(etatG),backgroundColor:Object.keys(etatG).map(k=>ECOL[k]||'#94a3b8'),borderWidth:0}]
  },options:{responsive:true,maintainAspectRatio:false,cutout:'55%',plugins:{legend:{position:'bottom',labels:{font:{size:12,family:'DM Sans'},usePointStyle:true,pointStyle:'circle',padding:16}}}}});

  // Chart Type (barres horizontales empilÃ©es)
  const typeG={};
  data.forEach(x=>{if(!typeG[x.type])typeG[x.type]={Actif:0,SPARE:0,HS:0,Rebus:0};typeG[x.type][x.etat]=(typeG[x.type][x.etat]||0)+1});
  const tLabels=Object.keys(typeG).sort((a,b)=>{const sa=Object.values(typeG[b]).reduce((s,v)=>s+v,0);const sb=Object.values(typeG[a]).reduce((s,v)=>s+v,0);return sa-sb});
  charts.type=new Chart(document.getElementById('chartType'),{type:'bar',data:{
    labels:tLabels,datasets:['Actif','SPARE','HS','Rebus'].map(e=>({label:e,data:tLabels.map(t=>typeG[t][e]||0),backgroundColor:ECOL[e]}))
  },options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,scales:{x:{stacked:true,grid:{display:false},ticks:{font:{size:11}}},y:{stacked:true,grid:{display:false},ticks:{font:{size:11,family:'DM Sans'}}}},plugins:{legend:{position:'bottom',labels:{font:{size:11,family:'DM Sans'},usePointStyle:true,pointStyle:'circle',padding:12}}}}});

  // Chart Marque (donut)
  const mG=groupBy(data.filter(x=>x.marque!=='-'),'marque');
  charts.marque=new Chart(document.getElementById('chartMarque'),{type:'doughnut',data:{
    labels:Object.keys(mG),datasets:[{data:Object.values(mG),backgroundColor:Object.keys(mG).map(k=>BCOL[k]||'#94a3b8'),borderWidth:0}]
  },options:{responsive:true,maintainAspectRatio:false,cutout:'45%',plugins:{legend:{position:'bottom',labels:{font:{size:12,family:'DM Sans'},usePointStyle:true,pointStyle:'circle',padding:16}}}}});

  // Chart VÃ©tustÃ©
  const ageG={"0-2 ans":0,"3-4 ans":0,"5-6 ans":0,"7+ ans":0};
  actifData.forEach(x=>{const a=age(x.dateAchat);if(a<=2)ageG["0-2 ans"]++;else if(a<=4)ageG["3-4 ans"]++;else if(a<=6)ageG["5-6 ans"]++;else ageG["7+ ans"]++});
  charts.age=new Chart(document.getElementById('chartAge'),{type:'bar',data:{
    labels:Object.keys(ageG),datasets:[{data:Object.values(ageG),backgroundColor:["#22c55e","#3b82f6","#f59e0b","#ef4444"],borderRadius:6}]
  },options:{responsive:true,maintainAspectRatio:false,scales:{x:{grid:{display:false},ticks:{font:{size:11}}},y:{grid:{color:'#f1f5f9'},ticks:{font:{size:11}}}},plugins:{legend:{display:false}}}});

  // Chart Top ModÃ¨les
  const modG=groupBy(data,'modele');
  const topMod=Object.entries(modG).sort((a,b)=>b[1]-a[1]).slice(0,8);
  charts.mod=new Chart(document.getElementById('chartModeles'),{type:'bar',data:{
    labels:topMod.map(x=>x[0]),datasets:[{data:topMod.map(x=>x[1]),backgroundColor:'#6366f1',borderRadius:6}]
  },options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,scales:{x:{grid:{display:false},ticks:{font:{size:11}}},y:{grid:{display:false},ticks:{font:{size:10,family:'DM Sans'}}}},plugins:{legend:{display:false}}}});

  // Alertes
  document.getElementById('alerts').innerHTML=`
    <div class="alert-box" style="background:linear-gradient(135deg,#fef3c7,#fefce8);border:1px solid #fde68a">
      <div class="icon">â°</div><div class="title" style="color:#92400e">Renouvellement Ã  prÃ©voir</div>
      <div class="value" style="color:#b45309">${obs}</div><div class="sub" style="color:#a16207">machines actives &gt; 5 ans</div>
    </div>
    <div class="alert-box" style="background:linear-gradient(135deg,#dbeafe,#eff6ff);border:1px solid #93c5fd">
      <div class="icon">ğŸ“¦</div><div class="title" style="color:#1e40af">Stock SPARE</div>
      <div class="value" style="color:#1d4ed8">${spare}</div><div class="sub" style="color:#3b82f6">${spare<10?'âš ï¸ Stock critique !':spare<20?'Stock correct':'Stock suffisant'}</div>
    </div>
    <div class="alert-box" style="background:linear-gradient(135deg,#fee2e2,#fef2f2);border:1px solid #fca5a5">
      <div class="icon">ğŸ”§</div><div class="title" style="color:#991b1b">MatÃ©riels HS / Rebus</div>
      <div class="value" style="color:#dc2626">${hs}</div><div class="sub" style="color:#ef4444">Ã  sortir du parc ou rÃ©parer</div>
    </div>`;

  // EntitÃ©s
  const eG=groupBy(data,'entreprise');
  const colors=[["#ede9fe","#c4b5fd"],["#dbeafe","#93c5fd"],["#dcfce7","#86efac"],["#fef3c7","#fde68a"],["#fce7f3","#f9a8d4"],["#e0f2fe","#7dd3fc"]];
  document.getElementById('entCards').innerHTML=Object.entries(eG).sort((a,b)=>b[1]-a[1]).map((e,i)=>{
    const c=colors[i%colors.length];
    const nom=e[0].split('-')[1]||e[0];
    return `<div class="ent-card" style="background:linear-gradient(135deg,${c[0]},white);border:1px solid ${c[1]}" onclick="document.getElementById('filterEnt').value='${selEnt.value===e[0]?'all':e[0]}';render()">
      <div class="val">${e[1]}</div><div class="name">${nom}</div></div>`;
  }).join('');
}

selType.addEventListener('change',render);
selEnt.addEventListener('change',render);
render();
</script>
</body>
</html>
